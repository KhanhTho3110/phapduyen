<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cửa Hàng Pháp Duyên - Vật Phẩm Tâm Linh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {'phap-duyen-vang': '#F59E0B', 'phap-duyen-nau': '#5B4B49', 'phap-duyen-nen': '#FEFDFB', 'facebook': '#1877F2', 'twitter': '#1DA1F2', 'youtube': '#FF0000',},
                    fontFamily: {'sans': ['Inter', 'sans-serif'], 'serif': ['"Noto Serif"', 'serif']},
                    animation: {'fade-in': 'fade-in 0.3s ease-out',},
                    keyframes: {'fade-in': {'0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' },}}
                }
            }
        }
		
// ----- Code cho Phân Trang (Tải thêm) -----
        
        // Đặt sự kiện này để đảm bảo code chạy sau khi trang đã tải xong
        document.addEventListener('DOMContentLoaded', (event) => {
            
            const videosPerPage = 10;
            let currentPage = 1;

            const videoListContainer = document.getElementById('video-list-container');
            // Lấy tất cả các video đã được render bởi Jinja2
            const allVideos = document.querySelectorAll('.video-item');
            
            if (allVideos.length === 0) return; // Không có video nào, không làm gì cả

            const totalPages = Math.ceil(allVideos.length / videosPerPage);

            const prevPageBtn = document.getElementById('prev-page-btn');
            const nextPageBtn = document.getElementById('next-page-btn');
            const pageDisplay = document.getElementById('page-number-display');

            function showPage(page) {
                currentPage = page;
                const startIndex = (page - 1) * videosPerPage;
                const endIndex = startIndex + videosPerPage;

                // 1. Ẩn tất cả video
                allVideos.forEach(video => {
                    video.style.display = 'none';
                });

                // 2. Chỉ hiển thị video cho trang hiện tại
                for (let i = startIndex; i < endIndex && i < allVideos.length; i++) {
                    allVideos[i].style.display = 'block';
                }

                // 3. Cập nhật số trang
                if (pageDisplay) {
                    pageDisplay.textContent = `Trang ${currentPage} / ${totalPages}`;
                }

                // 4. Cập nhật trạng thái nút
                if (prevPageBtn) {
                    prevPageBtn.disabled = (currentPage === 1);
                }
                if (nextPageBtn) {
                    nextPageBtn.disabled = (currentPage === totalPages);
                }
                
                // Ẩn/Hiện toàn bộ thanh phân trang nếu chỉ có 1 trang
                const paginationContainer = document.getElementById('pagination-container');
                if (paginationContainer) {
                    if (totalPages <= 1) {
                        paginationContainer.style.display = 'none';
                    } else {
                        paginationContainer.style.display = 'flex';
                    }
                }
            }

            // Gắn sự kiện cho các nút
            if (prevPageBtn) {
                prevPageBtn.addEventListener('click', () => {
                    if (currentPage > 1) {
                        showPage(currentPage - 1);
                    }
                });
            }
            
            if (nextPageBtn) {
                nextPageBtn.addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        showPage(currentPage + 1);
                    }
                });
            }

            // Hiển thị trang đầu tiên khi tải
            showPage(1);
        });
    </script>
    <style>
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 0.5rem; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    </style>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-phap-duyen-nen">
    <div class="max-w-md mx-auto min-h-screen bg-white text-phap-duyen-nau shadow-xl">
        
        <header class="bg-phap-duyen-nau text-white p-5 text-center rounded-t-lg relative z-10">
            <h1 class="text-3xl font-serif font-bold text-phap-duyen-vang">Pháp Duyên</h1>
            <p class="text-sm text-gray-200 mt-1">Gieo duyên lành, gặt quả thiện</p>
    
            <div class="flex justify-center space-x-6 mt-4">
                
                <a href="https://www.facebook.com/profile.php?id=61581831332376" target="_blank" rel="noopener noreferrer" class="hover:opacity-80 transition-opacity" title="Facebook">
                    <span class="sr-only">Facebook</span>
                    <img src="/static/facebook.png" alt="Facebook Icon" class="w-6 h-6">
                </a>
                
                <a href="https://www.youtube.com/channel/UCcLHjyFoquOScNkUWVNF57A/" target="_blank" rel="noopener noreferrer" class="hover:opacity-80 transition-opacity" title="YouTube">
                    <span class="sr-only">YouTube</span>
                    <img src="/static/youtube.png" alt="YouTube Icon" class="w-6 h-6">
                </a>
				
                <a href="https://s.shopee.vn/6KwIWAo9Yq?share_channel_code=5" target="_blank" rel="noopener noreferrer" class="hover:opacity-80 transition-opacity" title="TikTok">
                    <span class="sr-only">TikTok</span>
                    <img src="/static/tiktok.png" alt="TikTok Icon" class="w-6 h-6">
                </a>
                
                <a href="https://s.shopee.vn/6KwIWAo9Yq?share_channel_code=5" target="_blank" rel="noopener noreferrer" class="hover:opacity-80 transition-opacity" title="Twitter (X)">
                    <span class="sr-only">Twitter (X)</span>
                    <img src="/static/twitter.png" alt="Twitter Icon" class="w-6 h-6">
                </a>
                

                
            </div>
			
        </header>

		<nav class="flex justify-around bg-white p-2 sticky top-0 z-10 shadow-md">
            
            <button id="btn-products" class="flex-1 py-3 px-4 text-center text-sm font-semibold transition-all duration-300 border-b-4 border-phap-duyen-vang text-phap-duyen-nau">
                Sản Phẩm
            </button>
            
            <button id="btn-lectures" class="flex-1 py-3 px-4 text-center text-sm font-semibold transition-all duration-300 border-b-4 border-transparent text-gray-500 hover:text-phap-duyen-nau">
                Pháp Thoại
            </button>
            
            <button class="open-modal-btn flex-1 py-3 px-4 text-center text-sm font-semibold transition-all duration-300 border-b-4 border-transparent text-gray-500 hover:text-phap-duyen-nau">
                Gieo Duyên
            </button>
            
        </nav>


        <main id="products-section" class="p-4">
            <h2 class="text-xl font-bold text-phap-duyen-nau border-b-2 border-phap-duyen-vang pb-2 mb-4">Sản Phẩm Tâm Linh</h2>
            <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 p-3 rounded-lg text-sm mb-4">
                Mỗi sản phẩm bạn mua là một sự ủng hộ quý báu, giúp Pháp Duyên có thêm kinh phí để thực hiện và chia sẻ nhiều bài pháp thoại ý nghĩa hơn.
            </div>
            <div class="grid grid-cols-2 gap-4">
                {% for product in products %}
                <a href="{{ product.shopee_link_processed }}" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="block rounded-lg shadow-md overflow-hidden border border-gray-100 bg-phap-duyen-nen group hover:shadow-lg transition-shadow duration-200">
                    
                    <img src="{{ product.image_url_processed }}" 
                         alt="{{ product.name }}" class="w-full h-36 object-cover">
                    
                    <div class="p-3">
                        <h3 class="font-semibold text-sm truncate">{{ product.name }}</h3>
						<p class="text-xs text-gray-500 line-clamp-2">{{ product.description }}</p>
                        <p class="text-base font-bold text-red-700 mt-1">{{ product.price }}</p>
                        <div class="w-full bg-phap-duyen-vang text-white py-1.5 rounded-md mt-2 text-sm font-semibold text-center group-hover:bg-yellow-600 transition-colors">
                            Chi Tiết
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </main>

        
		<main id="lectures-section" class="p-4 space-y-6 hidden">
            <h2 class="text-xl font-bold text-phap-duyen-nau border-b-2 border-phap-duyen-vang pb-2 mb-4">
                Pháp Thoại & Giảng Đạo
            </h2>

            <div id="video-list-container" class="space-y-6">
                
                {% for video in videos|reverse %}
                <div class="video-item rounded-lg shadow-md border border-gray-100 bg-white">
                    <div class="video-container">
                        <iframe 
                            src="https://www.youtube.com/embed/{{ video.youtube_id }}" 
                            title="YouTube video player" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>
                    <div class="p-3">
                        <button class="open-modal-btn w-full bg-red-600 text-white py-2 rounded-md mt-2 text-sm font-semibold hover:bg-red-700 transition-colors">
                            Tuỳ hỷ ủng hộ
                        </button>
                    </div>
                </div>
                {% endfor %}
                </div>
            <div id="pagination-container" class="flex justify-between items-center pt-4 border-t border-gray-200">
                <button id="prev-page-btn" class="bg-phap-duyen-vang text-white font-semibold py-2 px-4 rounded-lg shadow hover:bg-yellow-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    &larr; Trang Trước
                </button>
                
                <span id="page-number-display" class="text-sm font-medium text-gray-700">
                    Trang 1 / 1
                </span>
                
                <button id="next-page-btn" class="bg-phap-duyen-vang text-white font-semibold py-2 px-4 rounded-lg shadow hover:bg-yellow-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Trang Sau &rarr;
                </button>
            </div>
        </main>
		
        <footer class="bg-phap-duyen-nau text-gray-200 p-6 text-center text-sm rounded-b-lg mt-6">
			
            <p class="font-bold text-white mb-2">Liên Hệ & Góp Duyên</p>
            <p>Email: <a href="mailto:loiphatday1109@gmail.com" class="text-phap-duyen-vang hover:underline">loiphatday1109@gmail.com</a></p>
            <p class="mt-2 text-xs">Hãy theo dõi chúng tôi trên mạng xã hội để cập nhật những bài pháp thoại mới nhất!</p>
            <p class="mt-4 text-xs text-gray-400">&copy; 2025 Pháp Duyên. Bảo lưu mọi quyền.</p>
			
			
			<div class="absolute bottom-6 right-6 flex items-center space-x-3 text-xs text-gray-500" title="Thống kê trang">
                
                <div class="flex items-center space-x-1" title="Khách duy nhất">
                    <i class="fas fa-users"></i>
                    <span class="font-medium">{{ stats.unique_visitors | default(0) }}</span>
                </div>
                
                <div class="flex items-center space-x-1" title="Lượt xem sản phẩm">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="font-medium">{{ stats.click_product | default(0) }}</span>
                </div>

                <div class="flex items-center space-x-1" title="Lượt click tùy hỷ">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span class="font-medium">{{ stats.click_donate | default(0) }}</span>
                </div>
            </div>
			
        </footer>
    </div>

	<div id="donationModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4 animate-fade-in">
			
			<div class="bg-white rounded-lg p-6 pt-8 w-full max-w-xs mx-auto text-center relative shadow-2xl">
				
				<button id="closeModalButton" class="absolute top-3 right-3 w-8 h-8 rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600 flex items-center justify-center transition-colors duration-200">
					<span class="sr-only">Đóng</span>
					<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
				</button>
				
				<div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100">
					<svg class="h-6 w-6 text-phap-duyen-vang" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" /></svg>
				</div>

				<h3 class="mt-4 text-xl font-bold text-phap-duyen-nau mb-2">Tuỳ hỷ ủng hộ</h3>
				
				<p class="text-sm text-gray-600 mb-5">
					Sự ủng hộ của quý vị là nguồn động viên lớn, giúp Pháp Duyên tiếp tục lan tỏa Phật pháp.
				</p>
				
				<div class="p-1 bg-white rounded-lg border-2 border-gray-200 shadow-sm inline-block">
					<img src="https://drive.google.com/thumbnail?id=1Vp2K5uNAhhFEtrxChYsgBu6KT_5MJhv3&sz=w500"
						 alt="Mã QR Ngân Hàng" class="w-48 h-48 mx-auto rounded-md">
				</div>
				
				<p class="mt-5 text-sm text-gray-700 italic">
					Xin chân thành cảm niệm công đức của quý vị!
				</p>
					
			</div>
		</div>
	
	
    <script>
        const btnProducts = document.getElementById('btn-products');
        const btnLectures = document.getElementById('btn-lectures');
        const productsSection = document.getElementById('products-section');
        const lecturesSection = document.getElementById('lectures-section');
        const donationModal = document.getElementById('donationModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const openModalButtons = document.querySelectorAll('.open-modal-btn');
        const activeClasses = 'border-phap-duyen-vang text-phap-duyen-nau';
        const inactiveClasses = 'border-transparent text-gray-500 hover:text-phap-duyen-nau';

        function setActiveTab(activeBtn, inactiveBtn, activeSection, inactiveSection) {
            activeBtn.classList.remove(...inactiveClasses.split(' '));
            activeBtn.classList.add(...activeClasses.split(' '));
            inactiveBtn.classList.remove(...activeClasses.split(' '));
            inactiveBtn.classList.add(...inactiveClasses.split(' '));
            activeSection.classList.remove('hidden');
            inactiveSection.classList.add('hidden');
        }
        if (btnProducts) { btnProducts.addEventListener('click', () => { setActiveTab(btnProducts, btnLectures, productsSection, lecturesSection); }); }
        if (btnLectures) { btnLectures.addEventListener('click', () => { setActiveTab(btnLectures, btnProducts, lecturesSection, productsSection); }); }
        openModalButtons.forEach(button => { button.addEventListener('click', () => { if (donationModal) { donationModal.style.display = 'flex'; } }); });
        if (closeModalButton) { closeModalButton.addEventListener('click', () => { if (donationModal) { donationModal.style.display = 'none'; } }); }
        if (donationModal) { donationModal.addEventListener('click', (event) => { if (event.target === donationModal) { donationModal.style.display = 'none'; } }); }
		
		
// --- BỘ THEO DÕI ANALYTICS MỚI ---
        const ANALYTICS_API_URL = "YOUR_ANALYTICS_LOGGING_API_URL_HERE"; // <-- Dán URL API GHI LOG ở Bước 1.2
        const productsContainer = document.getElementById('products-section');
        const lecturesContainer = document.getElementById('lectures-section');
        const donateButtons = document.querySelectorAll('.open-modal-btn');
        let userId = localStorage.getItem('phapduyen_uid');
        if (!userId) {
            userId = Math.random().toString(36).substring(2, 9); // Tạo ID duy nhất
            localStorage.setItem('phapduyen_uid', userId);
        }
        
        function sendAnalyticsEvent(eventType) {
            if (!ANALYTICS_API_URL.startsWith('http')) return;
            fetch(ANALYTICS_API_URL, {
                method: 'POST',
                mode: 'no-cors', // Cần thiết cho Google Apps Script
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ event: eventType, user_id: userId })
            }).then(response => {
                // Console.log("Gửi event thành công: " + eventType);
            }).catch(error => console.error("Lỗi gửi analytics:", error));
        }

        // 1. Theo dõi Page View (Truy cập duy nhất)
        sendAnalyticsEvent('PAGE_VIEW');
        
        // 2. Theo dõi Product Clicks
        if (productsContainer) {
            productsContainer.addEventListener('click', (e) => {
                if (e.target.closest('.rounded-lg.shadow-md')) {
                    sendAnalyticsEvent('CLICK_PRODUCT');
                }
            });
        }
        
        // 3. Theo dõi Video Clicks
        if (lecturesContainer) {
             lecturesContainer.addEventListener('click', (e) => {
                if (e.target.closest('.video-item')) {
                    sendAnalyticsEvent('CLICK_VIDEO');
                }
            });
        }

        // 4. Theo dõi Donate Clicks (Gieo Duyên / Tùy Hỷ)
        donateButtons.forEach(button => {
            button.addEventListener('click', () => {
                sendAnalyticsEvent('CLICK_DONATE');
            });
        });
        // ------------------------------------
		
    </script>
</body>
</html>